#summary Egy alap WIKI készítese a Yii (PHP) keretrendszer segítségével.

Ebben a rövidke leírásban azt szeretnénk bemutatni, hogy milyen egyszerű elkészíteni egy elegáns web-es alkalmazást a *Yii* segítségével. Ha a későbbiekben igény lesz rá, természetesen belevághatunk kényesebb témákba is, mint például a biztonság, cache-elés, komolyabb AR (ActiveRecord) használat stb. A helyesírásért már itt szeretnék elnézést kérni ...

= 0. Bevezetés =

Itt csak felsorolnék néhány alapvető (és igen fontos) fogalmat, amelyek ismerete szükséges :

- *Objektum Orientált Programozás (PHP 5)*: A jelenleg stabil Yii 1.1-es verzió a PHP 5.1-en alapszik, tehát annak ismerete mindenképp szükséges. ( http://hu.wikipedia.org/wiki/Objektumorientált_programozás )

- *Adatbázis (SQL)*: A Yii alapból sokféle adatbázis formátumot tartalmaz. (Az itteni példában én a SQLite-ot választottam, mert nem igényel különösebben bonyolult szerver oldali beállítást) ( http://hu.wikipedia.org/wiki/SQL )

- *MVC (Model-View-Controller) avagy Modell-Nézet-Vezérlő*: A Yii az egy MVC-t követő keretrendszer. Dióhéjban annyit jelent, hogy az alkalmazás jól elkülöníthető 3 részre. Az M vagy modell, ami az adatbázis jellegű lekérdezéseket végzi, a C vagy vezérlő ami kapcsolatot teremt és feldolgoz felhasználók által bevitt információt és végül a V vagy nézet, ami pedig a megjelenítést végzi. ( http://hu.wikipedia.org/wiki/MVC )

= 1. Adatbázis Felépítése =

*Adatbázis neve:* yiiki

*Táblák:*
{{{
++++++++++++++++++++++++++
+ pages                  +
++++++++++++++++++++++++++
+ id INT (auto_increment)+
+ title VARCHAR(125)     +
+ body TEXT              +
+ revision INT           +
+ created INT            +
++++++++++++++++++++++++++
}}}

*SQLite3:* CREATE TABLE pages (body TEXT, created integer, id INTEGER PRIMARY KEY, revision integer, title varchar(125));

= 2. A WEB-es alkalmazás létrehozása =

{{{
imehesz@imehesz-laptop:/var/www$ ./yii/framework/yiic webapp yiiki
Create a Web application under '/var/www/yiiki'? [Yes|No] yes
      mkdir /var/www/yiiki
      mkdir /var/www/yiiki/themes
      mkdir /var/www/yiiki/themes/classic
      mkdir /var/www/yiiki/themes/classic/views
      mkdir /var/www/yiiki/themes/classic/views/layouts
      mkdir /var/www/yiiki/themes/classic/views/system
   generate themes/classic/views/.htaccess
      mkdir /var/www/yiiki/themes/classic/views/site
   generate index.php
      mkdir /var/www/yiiki/css
   generate css/bg.gif
   generate css/form.css
   generate css/screen.css
   generate css/main.css
   generate css/ie.css
   generate css/print.css
      mkdir /var/www/yiiki/assets
      mkdir /var/www/yiiki/images
      mkdir /var/www/yiiki/protected
      mkdir /var/www/yiiki/protected/extensions
   generate protected/yiic.bat
      mkdir /var/www/yiiki/protected/models
   generate protected/models/LoginForm.php
   generate protected/models/ContactForm.php
   generate protected/yiic.php
      mkdir /var/www/yiiki/protected/data
   generate protected/data/schema.sqlite.sql
   generate protected/data/schema.mysql.sql
   generate protected/data/testdrive.db
      mkdir /var/www/yiiki/protected/controllers
   generate protected/controllers/SiteController.php
   generate protected/yiic
      mkdir /var/www/yiiki/protected/config
   generate protected/config/main.php
   generate protected/config/test.php
   generate protected/config/console.php
      mkdir /var/www/yiiki/protected/commands
      mkdir /var/www/yiiki/protected/commands/shell
      mkdir /var/www/yiiki/protected/messages
   generate protected/.htaccess
      mkdir /var/www/yiiki/protected/views
      mkdir /var/www/yiiki/protected/views/layouts
   generate protected/views/layouts/main.php
      mkdir /var/www/yiiki/protected/views/site
   generate protected/views/site/login.php
      mkdir /var/www/yiiki/protected/views/site/pages
   generate protected/views/site/pages/about.php
   generate protected/views/site/index.php
   generate protected/views/site/contact.php
   generate protected/views/site/error.php
      mkdir /var/www/yiiki/protected/runtime
      mkdir /var/www/yiiki/protected/tests
   generate protected/tests/WebTestCase.php
   generate protected/tests/phpunit.xml
   generate protected/tests/bootstrap.php
      mkdir /var/www/yiiki/protected/tests/report
      mkdir /var/www/yiiki/protected/tests/functional
   generate protected/tests/functional/SiteTest.php
      mkdir /var/www/yiiki/protected/tests/fixtures
      mkdir /var/www/yiiki/protected/tests/unit
      mkdir /var/www/yiiki/protected/components
   generate protected/components/Controller.php
   generate protected/components/UserIdentity.php
   generate index-test.php

Your application has been created successfully under /var/www/yiiki.

}}}

= 3. Az alkalmazas osszekapcsolasa az adatbazissal =

{{{
protected/config/main.php

...
 'db'=>array(                                                                                                         
              'connectionString' => 'sqlite:protected/data/yiiki.sqlite',
         ),
...
}}}

= 4. A yiic avagy a Yii varazspalcaja =

{{{
imehesz@imehesz-laptop:/var/www/yiiki$ ./protected/yiic shell
Yii Interactive Tool v1.1 (based on Yii v1.1.0)
Please type 'help' for help. Type 'exit' to quit.
>> _
}}}

== 4.1 A Pages modell letrehozasa a yiic segitsegevel ==

{{{
>> model Page pages
   generate models/Page.php
   generate fixtures/pages.php
   generate unit/PageTest.php

The following model classes are successfully generated:
    Page

If you have a 'db' database connection, you can test these models now with:
    $model=Page::model()->find();
    print_r($model);

>> 
}}}

= 5. Mi is az a CRUD? =

== 5.1 A Vezerlo es Nezet letrehozasa a CRUD paranccsal ==
{{{
>> crud Page
   generate PageController.php
   generate PageTest.php
      mkdir /var/www/yiiki/protected/views/page
   generate create.php
   generate update.php
   generate index.php
   generate view.php
   generate admin.php
   generate _form.php
   generate _view.php

Crud 'page' has been successfully created. You may access it via:
http://hostname/path/to/index.php?r=page

>> 
}}}

= 6. Gyors attekintes =

http://yiiki.lenny.local/index.php?r=page

= 7. Alkalmazasunk testreszabasa =

== 7.1 A beviteli form modositasa =

http://yiiki.lenny.local/index.php?r=page/create
protected/views/page/_form.php

{{{
<div class="form">

<?php echo CHtml::beginForm(); ?>

	<p class="note">Fields with <span class="required">*</span> are required.</p>

	<?php echo CHtml::errorSummary($model); ?>

    <div class="row">
		<?php echo CHtml::activeLabelEx($model,'title'); ?>
		<?php echo CHtml::activeTextField($model,'title',array('size'=>60,'maxlength'=>125)); ?>
		<?php echo CHtml::error($model,'title'); ?>
	</div>

	<div class="row">
		<?php echo CHtml::activeLabelEx($model,'body'); ?>
		<?php echo CHtml::activeTextArea($model,'body',array('rows'=>6, 'cols'=>50)); ?>
		<?php echo CHtml::error($model,'body'); ?>
	</div>

	<div class="row buttons">
		<?php echo CHtml::submitButton($model->isNewRecord ? 'Create' : 'Save'); ?>
	</div>

<?php echo CHtml::endForm(); ?>

</div><!-- form -->
}}}

== 7.2 A Page Modell szabalyainak beallitasa ==
protected/models/Page.php

{{{
	/**
	 * @return array validation rules for model attributes.
	 */
	public function rules()
	{
		// NOTE: you should only define rules for those attributes that
		// will receive user inputs.
		return array(
			array('created, revision', 'numerical', 'integerOnly'=>true),
			array('title', 'length', 'max'=>125),
              array('title', 'required', 'message'=>'Cimke nem lehet ures!'),
              array('title', 'unique'),
              array('title',
                      'match',
                      'pattern'=>'/^[A-Za-z0-9_]+$/',
                      'message' => 'Csak szamokat, betuket es `_` jelet hasznalhatsz! Hehe' ),
	      array('body', 'safe'),
		);
	}
}}}

== 7.3 A beforeSave() es save() modell fuggvenyek hasznalata/felulirasa ==

protected/models/Page.php
{{{
      /**
       *
       */
      public function beforeSave()
      {
         // and setting the created date ...
         $this->created=time();

         return parent::beforeSave();
      }
}}}

protected/models/Page.php
{{{
     /**
      *
      * @return <type>
      */
     public function save( $validate = true )
     {
         if( $this->isNewRecord )
         {
             // we increase the revision number ...
             $this->revision = $this->revision+1;
             return parent::save( $validate );
         }
         else
         {
             // by setting `save` to false, it will skip the validation,
             // so we can save the page with the same title
             // also, update is not really an update because every single change
             // will be a "new" page, so we can keep history ...
             $newpage = new Page();
             $newpage->attributes = $this->attributes;
             $newpage->save(false);
             return true;
         }
     }
}}}

== 7.4 Az oldalakat lekero SQL modositasa es a hozza tartozo Nezet testreszabasa ==

protected/controllers/PageController.php - actionIndex()

{{{
	/**
	 * Lists all models.
	 */
	public function actionIndex()
	{
        $criteria = new CDbCriteria();
        $criteria->group = 'title';
        $criteria->order = 'created DESC';

		$dataProvider=new CActiveDataProvider('Page', array(
			'pagination'=>array(
				'pageSize'=>self::PAGE_SIZE,
			),
            'criteria' => $criteria,
		));

		$this->render('index',array(
			'dataProvider'=>$dataProvider,
		));
	}
}}}

protected/views/page/index.php
protected/views/page/_view.php

{{{
<div class="view">
	<?php echo CHtml::link( CHtml::encode($data->title), $this->createUrl('page/view', array( 'title' => $data->title ) ) ); ?>
	(Rev.: <?php echo CHtml::encode($data->revision); ?>)
	<i><?php echo date( 'Y-m-d H:i', CHtml::encode($data->created) ); ?></i>
</div>
}}}

= Details =

Add your content here.  Format your content with:
  * Text in *bold* or _italic_
  * Headings, paragraphs, and lists
  * Automatic links to other wiki pages